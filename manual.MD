## **FLUJO GENERAL DEL PROCESO**

**1. CAJERO** ‚Üí Crea el "contrato" de venta y autoriza el transporte (camiones y choferes).
**2. PATIO** ‚Üí Selecciona un cami√≥n autorizado, crea el viaje, y confirma la carga real con foto.
**3. VIGILANCIA** ‚Üí Autoriza la salida del viaje y genera la gu√≠a de despacho.
**4. ADMIN** ‚Üí Mantiene los cat√°logos del sistema actualizados.
**5. REPORTES** ‚Üí Analiza las operaciones y exporta datos clave.

---

## **MANUAL POR ROL**

### **üè™ CAJERO - Comanda y Pago**

**Objetivo**: Crear la orden de venta (el "contrato"), procesar el pago y autorizar qu√© veh√≠culos y personal pueden realizar los despachos.

**Flujo diario**:

1.  **Seleccionar cliente y destino** desde los buscadores.
2.  **Construir la orden**:
    - Buscar y a√±adir productos con sus cantidades.
    - El sistema calcula los precios y subtotales autom√°ticamente.
3.  **Autorizar Transporte**:
    - En la secci√≥n de "Autorizaci√≥n de Transporte", **seleccionar uno o m√°s camiones** de la lista de veh√≠culos disponibles.
    - **Seleccionar uno o m√°s choferes** autorizados para realizar los retiros.
4.  **Revisar totales** y procesar el pago (Efectivo, Tarjeta, etc.).
5.  **Crear Pedido** ‚Üí La orden queda registrada con status `PAID` y con una lista de transporte autorizado, lista para que el patio la procese.

**Casos especiales**:

- √ìrdenes que ser√°n retiradas por varios camiones diferentes.
- Clientes que env√≠an distintos choferes para una misma orden.

---

### **üöõ PATIO - Creaci√≥n de Viaje y Carga**

**Objetivo**: Crear un viaje (despacho) para un cami√≥n autorizado y confirmar la cantidad real cargada.

**Flujo diario**:

1.  **Ver lista de √≥rdenes pagadas** que esperan ser despachadas.
2.  **Seleccionar la orden** que el cami√≥n ha venido a retirar.
3.  **En modal de creaci√≥n de viaje**:
    - Seleccionar la **placa del cami√≥n** que ha llegado (el sistema solo mostrar√° los autorizados por el cajero).
    - Seleccionar el **nombre del chofer** presente.
    - **Crear el Viaje** ‚Üí Esto genera un nuevo despacho con status `LOADING`.
4.  **En modal de confirmaci√≥n de carga**:
    - Ingresar la **cantidad real cargada**.
    - El sistema valida si la cantidad est√° dentro de la tolerancia permitida.
    - **Tomar foto obligatoria** del cami√≥n cargado.
    - Agregar observaciones si es necesario.
5.  **Confirmar Carga** ‚Üí El status del viaje cambia a `CARGADO`.

**Alertas importantes**:

- ‚ö†Ô∏è Cantidad fuera de tolerancia (requiere justificaci√≥n).
- ‚ö†Ô∏è Foto obligatoria (no se puede confirmar sin ella).
- ‚úÖ Carga dentro de la tolerancia (proceso normal).

---

### **üõ°Ô∏è VIGILANCIA - Control de Salida**

**Objetivo**: Autorizar salidas de viajes cargados y generar la documentaci√≥n legal.

**Flujo diario**:

1.  **B√∫squeda r√°pida** del viaje por placa, ID o cliente.
2.  **Verificar informaci√≥n**:
    - Revisar la foto de la carga tomada en el patio.
    - Confirmar que el status del viaje sea `CARGADO`.
3.  **Autorizar salida**:
    - **Tomar foto obligatoria** de la salida del cami√≥n.
    - El sistema genera autom√°ticamente la **Gu√≠a de Despacho**.
    - El status del viaje cambia a `EXITED` (o `COMPLETADO`).
    - El status general de la orden se actualiza (`PARTIALLY_DISPATCHED` o `DISPATCHED_COMPLETE`).

**Validaciones de seguridad**:

- ‚ùå No permite la salida si el viaje no est√° `CARGADO`.
- ‚ùå Requiere foto de salida obligatoria.

---

### **‚öôÔ∏è ADMIN - Gesti√≥n de Cat√°logos**

**(Sin cambios en este flujo)**

**Objetivo**: Mantener actualizados todos los cat√°logos del sistema (Productos, Clientes, Destinos, Camiones, Choferes, Usuarios).

---

### **üìä REPORTES - An√°lisis y Exportaci√≥n**

**(Sin cambios en este flujo)**

**Objetivo**: Generar reportes personalizados y m√©tricas de negocio con filtros por fecha, cliente, producto y status.

---

## **EJEMPLO DE CASO DE USO COMPLETO (ACTUALIZADO)**

### **Escenario**: "Constructora ABC" pide 30m¬≥ de arena, que ser√°n retirados por dos camiones distintos.

1.  **CAJERO** (9:00 AM):

    - Selecciona cliente "Constructora ABC" y destino "Obra Residencial Norte".
    - Agrega: Arena fina, 30m¬≥.
    - Total: $15,000 + impuestos.
    - Pago: Transferencia #TXN123456.
    - **Autoriza Transporte**:
      - Camiones: `ABC-123A`, `XYZ-789B`.
      - Choferes: `Juan P√©rez`, `Carlos G√≥mez`.
    - **Crea Pedido** ‚Üí Orden #152 queda en status `PAID`.

2.  **PATIO** (10:30 AM):

    - Llega el cami√≥n `ABC-123A` con `Juan P√©rez`.
    - El operador selecciona la Orden #152.
    - Selecciona el cami√≥n `ABC-123A` y al chofer `Juan P√©rez` de la lista de autorizados.
    - **Crea el Viaje** ‚Üí Se genera el Despacho #801.
    - Confirma la carga: 15.1m¬≥ (dentro de tolerancia).
    - Toma la foto del cami√≥n cargado.
    - **Confirma Carga** ‚Üí Viaje #801 queda `CARGADO`. La orden #152 pasa a `PARTIALLY_DISPATCHED`.

3.  **VIGILANCIA** (11:15 AM):
    - Busca por placa "ABC-123A".
    - Ve la foto del patio y los datos del viaje #801.
    - Toma la foto de salida.
    - **Autoriza Salida** ‚Üí Viaje #801 queda `EXITED`. Se genera su Gu√≠a de Despacho.

_(El proceso se repetir√≠a para el segundo cami√≥n `XYZ-789B` cuando llegue, creando un nuevo despacho asociado a la misma orden #152)_
